<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>note æŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>

  <!-- 98.css -->
  <link rel="stylesheet" href="https://unpkg.com/98.css" />

  <!-- FullCalendar -->
  <link
    href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css"
    rel="stylesheet"
  >

  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #008080;
      overflow: hidden;
    }

    #calendar-wrapper {
      height: calc(100vh - 170px);
      padding: 4px;
    }

    #calendar {
      height: 100%;
      background: white;
      border: 2px inset #c0c0c0;
      padding: 4px;
    }

    .controls {
      margin-bottom: 6px;
    }

    /* å¹´æœˆè¡¨ç¤º */
    .current-month {
      margin: 4px 0;
      padding: 2px 6px;
      background: #c0c0c0;
      border: 2px inset #fff;
      font-size: 12px;
      display: inline-block;
    }

    /* æ–‡å­—ã‚µã‚¤ã‚ºåˆ‡ã‚Šæ›¿ãˆ */
    .calendar-normal {
      font-size: 14px;
    }

    .calendar-large {
      font-size: 20px;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    #noteModal {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: none;
    }

    .status-bar {
      margin-top: 6px;
    }
  </style>
</head>

<body>

<div class="window" style="margin:8px;">
  <div class="title-bar">
    <div class="title-bar-text">note æŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
    <div class="title-bar-controls">
      <button aria-label="Close" onclick="document.body.innerHTML=''"></button>
    </div>
  </div>

  <div class="window-body">

    <div class="controls">
      <button id="prevMonth">â—€ å‰æœˆ</button>
      <button id="today">ä»Šæœˆ</button>
      <button id="nextMonth">æ¬¡æœˆ â–¶</button>
      |
      <button id="fontNormal">æ¨™æº–</button>
      <button id="fontLarge">å¤§</button>
    </div>

    <!-- å¹´æœˆè¡¨ç¤º -->
    <div class="current-month" id="currentMonth"></div>

    <div id="calendar-wrapper">
      <div id="calendar" class="calendar-normal"></div>
    </div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆæ™‚åˆ»ãªã—ï¼‰ -->
    <div class="status-bar">
      <p class="status-bar-field">ready</p>
    </div>

  </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="window" id="noteModal" style="width:300px;">
  <div class="title-bar">
    <div class="title-bar-text" id="modalTitle"></div>
    <div class="title-bar-controls">
      <button aria-label="Close" id="modalClose"></button>
    </div>
  </div>
  <div class="window-body">
    <p id="modalDate" style="font-size:12px;"></p>
    <p>
      <a id="modalLink" href="#" target="_blank">
        â–¶ noteã§è¨˜äº‹ã‚’é–‹ã
      </a>
    </p>
  </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- FullCalendar -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
$(function () {

  const calendarEl = document.getElementById('calendar');
  const modal = $('#noteModal');

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    timeZone: 'local',
    headerToolbar: false,
    fixedWeekCount: false,

    datesSet(info) {
      const date = info.start;
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      $('#currentMonth').text(`${year}å¹´ ${month}æœˆ`);
    },

    eventClick(info) {
      info.jsEvent.preventDefault();

      $('#modalTitle').text(info.event.title);
      $('#modalDate').text(
        info.event.start.toLocaleString('ja-JP')
      );
      $('#modalLink').attr('href', info.event.url);

      modal.show();
    }
  });

  calendar.render();

  $('#prevMonth').on('click', () => calendar.prev());
  $('#nextMonth').on('click', () => calendar.next());
  $('#today').on('click', () => calendar.today());
  $('#modalClose').on('click', () => modal.hide());

  /* æ–‡å­—ã‚µã‚¤ã‚ºåˆ‡ã‚Šæ›¿ãˆ */
  $('#fontNormal').on('click', () => {
    $('#calendar')
      .removeClass('calendar-large')
      .addClass('calendar-normal');
  });

  $('#fontLarge').on('click', () => {
    $('#calendar')
      .removeClass('calendar-normal')
      .addClass('calendar-large');
  });

  /* RSS */
  const feeds = [
    { id: 'mumeino', prefix: 'ğŸ“' },
    { id: 'info', prefix: 'ğŸ“¢' }
  ];

  feeds.forEach(feed => {
    const rssUrl = `https://note.com/${feed.id}/rss`;
    const apiUrl =
      'https://api.rss2json.com/v1/api.json?rss_url=' +
      encodeURIComponent(rssUrl);

    $.getJSON(apiUrl, function (res) {
      if (!res.items) return;

      res.items.forEach(item => {
        calendar.addEvent({
          title: `${feed.prefix} ${item.title}`,
          start: new Date(item.pubDate),
          url: item.link,
          allDay: true
        });
      });
    });
  });

});
</script>

</body>
</html>
